
---
# Bilibili 视频评论监控器

## 简介

这是一个用于监控 Bilibili 视频评论的 Python 脚本。它可以帮助您实时追踪您关注的 Bilibili 视频下的新评论和回复。脚本支持自定义检查频率，并允许用户随时手动触发评论检查，极大地提高了使用的灵活性和便利性。

## 功能特性

*   **实时监控**：自动检测指定 Bilibili 视频下的最新评论和回复。
*   **智能去重**：通过 SQLite 数据库记录已查看的评论 ID，避免重复通知。
*   **子评论抓取**：自动递归抓取所有层级的子评论，确保不遗漏任何回复。
*   **自定义检查间隔**：用户可以设置每次评论检查循环之间的等待时间（分钟）。
*   **手动触发检查**：在等待期间，用户可以随时按下 `Enter` 键，立即开始新一轮的评论检查。
*   **交互式菜单**：提供友好的命令行菜单，方便添加、移除和选择要监控的视频。
*   **自动 Cookie 处理**：如果 `bili_cookie.txt` 文件不存在或为空，脚本会尝试调用 `login_bilibili.py` 进行自动登录并获取 Cookie。
*   **跨平台兼容**：支持 Windows、Linux 和 macOS 等主流操作系统，已优化 Windows 下的键盘输入检测。

## 先决条件

在运行此脚本之前，请确保您的系统已安装以下软件和库：

*   **Python 3.6+**
*   **pip** (Python 包管理器)

### 必需的 Python 库

您可以通过以下命令安装所有必需的 Python 库：

```bash
pip install requests pandas
```

*   `requests`: 用于发送 HTTP 请求，与 Bilibili API 交互。
*   `pandas`: 用于处理时间戳，将 Unix 时间戳转换为易读的日期时间格式。
*   `sqlite3`: Python 内置，无需额外安装，用于本地数据库存储。
*   `msvcrt` (仅限 Windows): 用于 Windows 系统下非阻塞地检测键盘输入，Python 内置，无需额外安装。
*   `select` (仅限 Linux/macOS): 用于类 Unix 系统下非阻塞地检测标准输入，Python 内置，无需额外安装。

## 安装

1.  **下载或克隆项目**：
    将 `database.py` 和 `main.py` 文件下载到同一个文件夹中。
    （可选）如果您有 `login_bilibili.py` 脚本，也请将其放在同一文件夹中，以便自动处理 Cookie。

2.  **安装依赖**：
    打开您的终端或命令提示符，导航到项目文件夹，然后运行：
    ```bash
    pip install requests pandas
    ```

## 使用方法

1.  **准备 Bilibili Cookie**：
    *   脚本需要您的 Bilibili Cookie 来访问评论 API。
    *   请在项目文件夹中创建一个名为 `bili_cookie.txt` 的文件。
    *   将您的 Bilibili Cookie 字符串完整地复制粘贴到 `bili_cookie.txt` 文件中。
    *   **获取 Cookie 的方法**：
        1.  打开 Bilibili 网站并登录您的账号。
        2.  打开浏览器的开发者工具 (通常按 `F12`)。
        3.  切换到 "网络" (Network) 或 "应用程序" (Application) 选项卡。
        4.  刷新页面，找到任意 Bilibili 域名的请求 (例如 `api.bilibili.com` 或 `www.bilibili.com`)。
        5.  在请求头 (Request Headers) 中找到 `Cookie` 字段，复制其后的完整字符串。
    *   **（推荐）自动登录**：如果您有 `login_bilibili.py` 脚本，可以将其放在与 `main.py` 同一目录下。当 `bili_cookie.txt` 不存在或为空时，`main.py` 会自动尝试调用它来获取 Cookie。

2.  **运行监控器**：
    在终端或命令提示符中，导航到项目文件夹，然后运行：

    ```bash
    python main.py
    ```

3.  **交互式菜单操作**：
    脚本启动后，将显示一个主菜单：
    *   **添加视频 (`a`)**：输入 `a`，然后输入您要监控的 Bilibili 视频的 BV 号（支持批量添加，用逗号或空格分隔）。
    *   **移除视频 (`r`)**：输入 `r`，然后输入列表中对应视频的编号以移除它。
    *   **选择视频 (`数字`)**：输入视频列表前的数字（如 `1` 或 `1,3`），将这些视频加入本次监控。
    *   **开始监控 (`s`)**：输入 `s`，开始对已选择的视频进行评论监控。
    *   **退出程序 (`q`)**：输入 `q` 退出脚本。

4.  **设置检查间隔与手动触发**：
    *   在您选择要监控的视频并输入 `s` 开始后，脚本会提示您输入检查间隔（分钟）。您可以输入一个数字，或者直接按 `Enter` 使用默认的 5 分钟间隔。
    *   进入监控循环后，脚本会显示等待信息，例如：
        ```
        所有视频检查完毕。等待 5 分钟 0 秒后进行下一轮检查...
        您可以随时按下 [Enter] 键来立即开始下一轮检查。
        ```
    *   在此期间，您可以随时按下键盘上的 `Enter` 键，脚本将立即中断等待，并开始新一轮的评论检查。

## 注意事项

*   **Cookie 有效性**：Bilibili 的 Cookie 可能会过期。如果脚本长时间运行后不再能检测到新评论，或者提示 Cookie 错误，请更新 `bili_cookie.txt` 中的 Cookie，或确保 `login_bilibili.py` 能正常工作。
*   **请求频率**：请勿将检查间隔设置得过短（脚本已限制最低 30 秒），以免对 Bilibili 服务器造成不必要的负担，或导致您的 IP 被暂时限制。
*   **网络连接**：确保您的网络连接稳定，否则可能导致 API 请求失败。
*   **数据库文件**：脚本会在首次运行时自动创建 `bilibili_monitor.db` 文件，用于存储视频信息和已查看的评论 ID。请勿随意删除此文件，除非您希望重置所有已监控的数据。

## 许可证

本项目采用 MIT 许可证。

---