
---

# B站评论区监控器 (增强版？)

## 简介

这是一个~~功能强大~~的 Bilibili 视频评论区监控 Python 脚本。它能实时追踪您关注的视频下的新评论（包括所有楼中楼回复），并通过控制台和 **Webhook** 两种方式进行通知。

脚本支持自定义检查频率，并允许用户随时手动触发检查，还提供了完整的交互式菜单来管理监控列表，极大地提高了使用的灵活性和便利性。

## 🚀 功能特性

*   **实时监控**：自动检测指定 Bilibili 视频下的最新评论和回复。
*   **Webhook 通知**：当发现新评论时，可自动通过 Webhook (支持飞书、钉钉、Discord 等) 发送格式化好的实时通知。
*   **智能去重**：通过本地 SQLite 数据库记录已发现的评论 ID，确保程序重启也不会重复通知。
*   **深度评论抓取**：能够智能检测并抓取所有分页的楼中楼回复，确保不遗漏任何被折叠的子评论。
*   **交互式菜单**：提供友好的命令行菜单，方便地添加、移除和选择要监控的视频。
*   **自动 Cookie 处理**：若 `bili_cookie.txt` 不存在或为空，脚本会自动尝试调用 `login_bilibili.py` 来完成登录并获取 Cookie。
*   **双重触发机制**：
    *   **定时触发**：用户可自定义每次检查的间隔时间。
    *   **手动触发**：在等待期间，可随时按 `Enter` 键立即开始新一轮检查。
*   **跨平台兼容**：完美支持 Windows、Linux 和 macOS 系统。

## 📂 文件结构

为了使脚本正常工作，请确保以下文件位于同一个目录下：

```
.
├── main.py          # 监控主程序 
├── database.py         # 数据库操作模块
├── notifier.py         # Webhook 通知模块
|
├── login_bilibili.py   # (可选) B站登录脚本，用于自动获取Cookie
|
├── webhook_config.txt  # (需手动创建) 用于存放你的 Webhook URL
├── bili_cookie.txt     # (自动或手动创建) 存储登录后的Cookie
└── bili_monitor.db     # (自动生成) SQLite数据库文件
```

## 🛠️ 安装与设置

### 1. 准备环境

确保您的系统已安装 **Python 3.6+** 和 **pip** 包管理器。

### 2. 下载文件

将 `main.py`, `database.py`, `notifier.py` 和 `login_bilibili.py` (可选) 文件下载到同一个文件夹中。

### 3. 安装依赖库

打开您的终端或命令提示符，进入项目文件夹，然后运行以下命令来安装所有必需的库：

```bash
pip install requests pandas
```

*   `requests`: 用于发送 HTTP 请求，与 Bilibili API 和 Webhook URL 交互。
*   `pandas`: 用于处理时间戳，将其转换为易于阅读的日期时间格式。

## 📖 使用方法

1.  **配置 Webhook (可选，但推荐)**
    *   在项目文件夹中，手动创建一个名为 `webhook_config.txt` 的文件。
    *   将您的 Webhook URL 完整地粘贴到该文件中并保存。**文件中只应包含 URL 本身**。
    *   如果此文件不存在或为空，Webhook 通知功能将自动禁用。

2.  **准备 Bilibili Cookie**
    *   **方法一 (推荐)：自动获取**
        *   确保 `login_bilibili.py` 与主程序在同一目录。
        *   直接运行 `main.py`，如果 `bili_cookie.txt` 不存在，脚本会自动调用登录程序，请按提示扫码登录。
    *   **方法二：手动配置**
        *   在项目文件夹中创建 `bili_cookie.txt` 文件。
        *   登录 Bilibili 网站，使用浏览器开发者工具 (`F12`) 获取您的 `Cookie` 值，并将其完整粘贴到文件中。

3.  **运行监控器**
    在终端中，导航到项目文件夹，然后运行：
    ```bash
    python monitor.py
    ```

4.  **交互式菜单操作**
    *   **添加视频 (`a`)**: 输入 `a`，然后输入 B站视频的 BV 号（支持用逗号或空格批量添加）。
    *   **移除视频 (`r`)**: 输入 `r`，然后输入列表中视频对应的编号以将其从数据库移除。
    *   **选择视频 (`数字`)**: 输入视频列表前的数字（如 `1` 或 `1,3`）来选择本次要监控的视频。
    *   **开始监控 (`s`)**: 选择好视频后，输入 `s` 继续。
    *   **退出程序 (`q`)**: 输入 `q` 退出。

5.  **启动监控**
    *   **启用 Webhook**：如果您已配置 `webhook_config.txt`，脚本会询问您是否启用通知，输入 `y` 即可。
    *   **设置检查间隔**：脚本会提示您输入检查间隔（分钟）。您可以输入数字，或直接按 `Enter` 使用默认的 5 分钟。
    *   **手动触发**：在监控循环的等待期间，您可以随时按下 `Enter` 键，立即开始新一轮的评论检查。

## ⚠️ 注意事项

*   **Webhook 安全**：请勿将包含您的 Webhook URL 的 `webhook_config.txt` 文件泄露给他人。
*   **Cookie 有效性**：Bilibili 的 Cookie 会过期。如果脚本提示 Cookie 错误或无法获取信息，请删除 `bili_cookie.txt` 并重新运行脚本以自动登录，或手动更新其中的值。
*   **请求频率**：请勿将检查间隔设置得过短（脚本已限制最低 30 秒），以免对 Bilibili 服务器造成不必要的负担，或导致您的 IP 被暂时限制。
*   **数据库文件**：脚本会自动创建和管理 `bili_monitor.db` 文件。请勿随意删除，否则会丢失所有已监控视频的配置和历史评论记录。

## 许可证

本项目采用 MIT 许可证。